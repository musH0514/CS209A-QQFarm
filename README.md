# QQ Farm 多人联机农场游戏
## 项目介绍
本项目基于Java Socket、多线程和JavaFX实现了简化版的多人联机QQ农场游戏，支持种植、收获、偷取好友作物等核心功能，保证服务端数据的线程安全和客户端UI的实时响应。

## 技术栈
- Java 17+
- JavaFX 21（UI界面）
- Socket编程（网络通信）
- 多线程（并发处理）
- 锁机制（ReentrantLock，保证线程安全）

## 项目结构
QQFarm/

├── src/

│ ├── main/

│ │ ├── java/

│ │ │ ├── module-info.java // 模块配置

│ │ │ └── org/example/

│ │ │ ├── common/ // 公共枚举和协议

│ │ │ │ ├── CropState.java // 作物状态（空 / 生长中 / 成熟）

│ │ │ │ └── Protocol.java // 网络通信协议

│ │ │ ├── server/ // 服务端代码

│ │ │ │ ├── Farm.java // 农场地块管理

│ │ │ │ ├── Player.java // 玩家信息（金币、农场、在线状态）

│ │ │ │ ├── Server.java // 服务端主程序

│ │ │ │ └── ServerHandler.java// 客户端连接处理

│ │ │ └── client/ // 客户端代码

│ │ │ ├── ClientNetwork.java// 网络通信封装

│ │ │ ├── FarmClient.java // 客户端主程序

│ │ │ ├── FarmController.java// UI 控制器

│ │ └── resources/

│ │ └── org/example/client/

│ │ └── FarmUI.fxml // UI 布局文件

└── README.md // 项目说明


## 运行说明
### 前置条件
1. 安装JDK 17+
2. 配置JavaFX环境（或使用Maven/Gradle引入依赖）

### 启动步骤
1. **启动服务端**
    - 运行 `org.example.qq_farm.server.Server` 类
    - 服务端将监听8888端口，启动作物生长定时线程（10秒成熟）

2. **启动客户端**
    - 运行 `org.example.qq_farm.client.Client` 类
    - 输入用户名登录，即可进入农场界面

### 功能操作
1. **种植**：点击自己农场的“空”地块，消耗10金币种植作物（10秒后成熟）
2. **收获**：点击成熟的作物，获得对应金币
3. **访问好友**：点击“访问好友”按钮，输入好友用户名，查看好友农场
4. **偷取**：访问好友农场时，若好友离线且作物成熟，点击地块偷取25%产量

## 核心特性
### 服务端
1. 多线程处理客户端连接（线程池）
2. 作物自动生长（定时线程）
3. 线程安全的地块操作（ReentrantLock）
4. 原子性的种植/收获/偷取逻辑

### 客户端
1. 异步网络通信（不阻塞UI线程）
2. 实时UI更新（Platform.runLater保证线程安全）
3. 友好的状态提示和错误处理
4. 支持访问好友农场和偷取功能

## 通信协议
| 指令方向 | 指令名 | 格式 | 说明 |
|---------|--------|------|------|
| 客户端→服务端 | LOGIN | LOGIN\|用户名 | 玩家登录 |
| 客户端→服务端 | PLANT | PLANT\|用户名\|行\|列 | 种植作物 |
| 客户端→服务端 | HARVEST | HARVEST\|用户名\|行\|列 | 收获作物 |
| 客户端→服务端 | VISIT | VISIT\|用户名\|好友名 | 访问好友 |
| 客户端→服务端 | STEAL | STEAL\|用户名\|受害者\|行\|列 | 偷取作物 |
| 客户端→服务端 | RECONNECT | RECONNECT\|用户名 | 重连服务器 |
| 服务端→客户端 | STATE_UPDATE | STATE_UPDATE\|用户名\|行\|列\|状态\|金币 | 农场状态更新 |
| 服务端→客户端 | SUCCESS | SUCCESS\|消息 | 操作成功 |
| 服务端→客户端 | FAIL | FAIL\|消息 | 操作失败 |
| 服务端→客户端 | ERROR | ERROR\|消息 | 错误提示 |
| 服务端→客户端 | DISCONNECT | DISCONNECT | 强制断开 |

## 异常处理
1. 服务端崩溃：客户端提示断开连接，禁用操作按钮
2. 客户端断开：服务端标记玩家离线，释放资源
3. 网络异常：客户端友好提示，支持重连
4. 非法操作：服务端验证并返回失败提示（如种植在非空地块）